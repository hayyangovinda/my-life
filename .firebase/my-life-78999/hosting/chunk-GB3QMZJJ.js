import{b as E}from"./chunk-BXZAQA36.js";import"./chunk-GIDJWLZK.js";import{a as G}from"./chunk-D6VDJXMI.js";import{a as z}from"./chunk-XVXDBZAN.js";import"./chunk-GTL4EDMA.js";import{p as T}from"./chunk-E6I4JPOI.js";import{$ as l,Ab as c,Bb as w,Eb as M,Jb as h,Lb as O,Tb as p,Ub as P,Va as d,Vb as S,_b as k,bc as D,dc as I,ea as x,oa as u,pa as v,qa as f,ra as y,vb as b,xb as _,yb as C,zb as a}from"./chunk-FVMQVLXL.js";import"./chunk-CWTPBX7D.js";function j(s,o){if(s&1){let g=M();a(0,"div",5),h("click",function(){let e=u(g).$implicit,t=O();return v(t.goToResult(e))}),a(1,"div",6),p(2,"\u{1F4D6}"),c(),p(3),D(4,"date"),c()}if(s&2){let g=o.$implicit;d(3),S(" ",I(4,1,g.date,"EEEE, dd MMMM yyyy")," ")}}var Z=(()=>{let o=class o{constructor(){this.sharingService=l(G),this.httpService=l(z),this.router=l(E),this.context="",this.results=[],this.dayChats=[]}ngOnInit(){this.sharingService.groupToView$.subscribe(n=>{this.group=n;let e=this.getItemAndCheckDate(this.group._id);if(e){this.results=e;return}this.getContext()})}toggleSidenav(){this.sharingService.toggleSidenav()}getContext(){this.httpService.getAllDayChats().subscribe(n=>{this.dayChats=n;let e=n.map(t=>{let r=t.inputs.filter(i=>i.type==="sent").map(i=>i.text).join(",");return{dayId:t._id,inputs:r}});this.context=JSON.stringify(e),this.askGemini()})}askGemini(){let e=this.context+"group name: "+this.group.name+"group description: "+this.group.description+"Base on the above context, answer the following question, by returning only only only(not even /n,or whitespaces) an array of id or ids of the day chats that are relevantto the group name and group description. If no relevant day chats are found, return an empty array. Do not invent your own story, base it on the given prompts. Do not return anything other than the array of ids. Return the array so that it can be assigned directly to a variable in js.";this.httpService.generateStory({prompt:e}).subscribe(t=>{console.log(t),JSON.parse(t.generatedText).forEach(i=>{let m=this.dayChats.find(H=>H._id===i);m&&this.results.push(m)}),this.saveItemWithDate(this.group._id,this.results)})}saveItemWithDate(n,e){let t=new Date;t.setHours(0,0,0,0);let r={value:e,date:t.getTime()};localStorage.setItem(n,JSON.stringify(r))}getItemAndCheckDate(n){let e=localStorage.getItem(n);if(!e)return null;let t=JSON.parse(e),r=new Date(t.date),i=new Date;return i.setHours(0,0,0,0),r.getTime()!==i.getTime()?(localStorage.removeItem(n),null):t.value}goToResult(n){this.sharingService.updateDayToGenerate(n),this.router.navigateByUrl("story/"+n._id)}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=x({type:o,selectors:[["app-group-details"]],standalone:!0,features:[k],decls:10,vars:1,consts:[[1,"header-container"],["xmlns","http://www.w3.org/2000/svg","height","30px","viewBox","0 -960 960 960","width","30px","fill","var(--black-text-color)",3,"click"],["d","M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"],[1,"daily-stories-body"],[1,"daily-stories-item","row"],[1,"daily-stories-item","row",3,"click"],[1,"img"]],template:function(e,t){e&1&&(a(0,"main")(1,"header")(2,"div",0),f(),a(3,"svg",1),h("click",function(){return t.toggleSidenav()}),w(4,"path",2),c(),y(),a(5,"h5"),p(6),c()()(),a(7,"div",3),_(8,j,5,4,"div",4,b),c()()),e&2&&(d(6),P(t.group.name),d(2),C(t.results))},dependencies:[T],styles:["main[_ngcontent-%COMP%]{height:100%;overflow-y:hidden;background-color:var(--secondary-bg-color)}footer[_ngcontent-%COMP%]{position:absolute;bottom:5px;width:100%;display:flex;align-items:center}footer[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{flex:1;padding:10px;border:1px solid #ddd;border-radius:10px;resize:none;height:40px;max-height:120px;overflow-y:auto;outline:none}.camera[_ngcontent-%COMP%]{width:30px;height:30px;margin-left:10px;border-radius:50%}.send[_ngcontent-%COMP%]{width:30px;height:30px;margin-right:10px;border-radius:50%}.chat-body[_ngcontent-%COMP%]{height:calc(100% - 100px);overflow-y:scroll;padding:10px;display:flex;flex-direction:column;gap:10px;font-size:.9rem}.message[_ngcontent-%COMP%]{margin-bottom:10px;padding:8px;border-radius:8px;word-wrap:break-word;max-width:90%}.message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.message.received[_ngcontent-%COMP%]{color:var(--black-text-color);text-align:left;align-self:flex-start;background-color:var(--main-bg-color)}.message.sent[_ngcontent-%COMP%]{color:var(--sent-text-color);align-self:flex-end;margin-left:auto;display:inline-block;background-color:var(--primary-color);padding:5px 10px;text-align:right}textarea[_ngcontent-%COMP%]{flex:1;resize:none;padding:8px;border-radius:8px;border:1px solid #ccc;width:100%;background-color:var(--secondary-bg-color);color:var(--black-text-color)}.send[_ngcontent-%COMP%], .camera[_ngcontent-%COMP%]{cursor:pointer}.received-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.received-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px;height:30px}header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;background-image:var(--header-border-color);border:0;box-shadow:var(--header-shadow);box-sizing:border-box;padding-bottom:1px}header[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:30px;height:30px;cursor:pointer;margin-left:10px}h5[_ngcontent-%COMP%]{color:var(--title-color);font-size:15px}.header-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;background-color:var(--secondary-bg-color);padding:9px 3px;width:100%;height:100%;color:#757575}.message-container[_ngcontent-%COMP%]{position:relative}.delete-icon[_ngcontent-%COMP%]{width:19px;height:19px;cursor:pointer;position:absolute;right:-17px;top:-12px}.text-area-wrapper[_ngcontent-%COMP%]{width:100%;margin:0 10px;position:relative}.text-area-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;right:12px;bottom:12px;cursor:pointer}.chat-image[_ngcontent-%COMP%]{max-width:100%;height:200px;object-fit:cover}.loader[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#252525e6;z-index:100;display:flex;align-items:center;justify-content:center}",".daily-stories-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%;padding:20px;color:var(--black-text-color);background-color:var(--main-bg-color)}.main-daily[_ngcontent-%COMP%]{height:100%;background-color:var(--main-bg-color)}.row[_ngcontent-%COMP%]{width:100%;margin-bottom:20px;height:50px;background-color:var(--secondary-bg-color);border-radius:10px;box-shadow:0 10px 15px #0000000a;justify-content:flex-start;display:flex;align-items:center;font-size:15px;gap:10px;color:var(--row-text-color)}.row[_ngcontent-%COMP%]   .img[_ngcontent-%COMP%]{margin-bottom:7px;margin-left:10px;font-size:17px}"]});let s=o;return s})();export{Z as GroupDetailsComponent};
