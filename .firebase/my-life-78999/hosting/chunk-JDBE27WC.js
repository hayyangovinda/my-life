import{b as ee}from"./chunk-JF4YXBEL.js";import{d as I,e as Oe,f as O}from"./chunk-CWTPBX7D.js";var te=I((Le,re)=>{"use strict";function be(i){return i&&i.__esModule?i:{default:i}}re.exports=be});var ne=I((De,Y)=>{"use strict";var V=function(i){"use strict";var a=Object.prototype,s=a.hasOwnProperty,d=Object.defineProperty||function(r,e,t){r[e]=t.value},u,h=typeof Symbol=="function"?Symbol:{},l=h.iterator||"@@iterator",R=h.asyncIterator||"@@asyncIterator",w=h.toStringTag||"@@toStringTag";function m(r,e,t){return Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),r[e]}try{m({},"")}catch{m=function(e,t,o){return e[t]=o}}function W(r,e,t,o){var n=e&&e.prototype instanceof k?e:k,c=Object.create(n.prototype),f=new x(o||[]);return d(c,"_invoke",{value:Se(r,t,f)}),c}i.wrap=W;function M(r,e,t){try{return{type:"normal",arg:r.call(e,t)}}catch(o){return{type:"throw",arg:o}}}var X="suspendedStart",Ee="suspendedYield",$="executing",L="completed",y={};function k(){}function D(){}function S(){}var F={};m(F,l,function(){return this});var U=Object.getPrototypeOf,G=U&&U(U(B([])));G&&G!==a&&s.call(G,l)&&(F=G);var _=S.prototype=k.prototype=Object.create(F);D.prototype=S,d(_,"constructor",{value:S,configurable:!0}),d(S,"constructor",{value:D,configurable:!0}),D.displayName=m(S,w,"GeneratorFunction");function J(r){["next","throw","return"].forEach(function(e){m(r,e,function(t){return this._invoke(e,t)})})}i.isGeneratorFunction=function(r){var e=typeof r=="function"&&r.constructor;return e?e===D||(e.displayName||e.name)==="GeneratorFunction":!1},i.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,S):(r.__proto__=S,m(r,w,"GeneratorFunction")),r.prototype=Object.create(_),r},i.awrap=function(r){return{__await:r}};function A(r,e){function t(c,f,p,g){var v=M(r[c],r,f);if(v.type==="throw")g(v.arg);else{var j=v.arg,N=j.value;return N&&typeof N=="object"&&s.call(N,"__await")?e.resolve(N.__await).then(function(P){t("next",P,p,g)},function(P){t("throw",P,p,g)}):e.resolve(N).then(function(P){j.value=P,p(j)},function(P){return t("throw",P,p,g)})}}var o;function n(c,f){function p(){return new e(function(g,v){t(c,f,g,v)})}return o=o?o.then(p,p):p()}d(this,"_invoke",{value:n})}J(A.prototype),m(A.prototype,R,function(){return this}),i.AsyncIterator=A,i.async=function(r,e,t,o,n){n===void 0&&(n=Promise);var c=new A(W(r,e,t,o),n);return i.isGeneratorFunction(e)?c:c.next().then(function(f){return f.done?f.value:c.next()})};function Se(r,e,t){var o=X;return function(c,f){if(o===$)throw new Error("Generator is already running");if(o===L){if(c==="throw")throw f;return Z()}for(t.method=c,t.arg=f;;){var p=t.delegate;if(p){var g=K(p,t);if(g){if(g===y)continue;return g}}if(t.method==="next")t.sent=t._sent=t.arg;else if(t.method==="throw"){if(o===X)throw o=L,t.arg;t.dispatchException(t.arg)}else t.method==="return"&&t.abrupt("return",t.arg);o=$;var v=M(r,e,t);if(v.type==="normal"){if(o=t.done?L:Ee,v.arg===y)continue;return{value:v.arg,done:t.done}}else v.type==="throw"&&(o=L,t.method="throw",t.arg=v.arg)}}}function K(r,e){var t=e.method,o=r.iterator[t];if(o===u)return e.delegate=null,t==="throw"&&r.iterator.return&&(e.method="return",e.arg=u,K(r,e),e.method==="throw")||t!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+t+"' method")),y;var n=M(o,r.iterator,e.arg);if(n.type==="throw")return e.method="throw",e.arg=n.arg,e.delegate=null,y;var c=n.arg;if(!c)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,y;if(c.done)e[r.resultName]=c.value,e.next=r.nextLoc,e.method!=="return"&&(e.method="next",e.arg=u);else return c;return e.delegate=null,y}J(_),m(_,w,"Generator"),m(_,l,function(){return this}),m(_,"toString",function(){return"[object Generator]"});function Pe(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function q(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function x(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(Pe,this),this.reset(!0)}i.keys=function(r){var e=Object(r),t=[];for(var o in e)t.push(o);return t.reverse(),function n(){for(;t.length;){var c=t.pop();if(c in e)return n.value=c,n.done=!1,n}return n.done=!0,n}};function B(r){if(r){var e=r[l];if(e)return e.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var t=-1,o=function n(){for(;++t<r.length;)if(s.call(r,t))return n.value=r[t],n.done=!1,n;return n.value=u,n.done=!0,n};return o.next=o}}return{next:Z}}i.values=B;function Z(){return{value:u,done:!0}}return x.prototype={constructor:x,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(q),!r)for(var e in this)e.charAt(0)==="t"&&s.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=u)},stop:function(){this.done=!0;var r=this.tryEntries[0],e=r.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function t(g,v){return c.type="throw",c.arg=r,e.next=g,v&&(e.method="next",e.arg=u),!!v}for(var o=this.tryEntries.length-1;o>=0;--o){var n=this.tryEntries[o],c=n.completion;if(n.tryLoc==="root")return t("end");if(n.tryLoc<=this.prev){var f=s.call(n,"catchLoc"),p=s.call(n,"finallyLoc");if(f&&p){if(this.prev<n.catchLoc)return t(n.catchLoc,!0);if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else if(f){if(this.prev<n.catchLoc)return t(n.catchLoc,!0)}else if(p){if(this.prev<n.finallyLoc)return t(n.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,e){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.tryLoc<=this.prev&&s.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var n=o;break}}n&&(r==="break"||r==="continue")&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var c=n?n.completion:{};return c.type=r,c.arg=e,n?(this.method="next",this.next=n.finallyLoc,y):this.complete(c)},complete:function(r,e){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&e&&(this.next=e),y},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===r)return this.complete(t.completion,t.afterLoc),q(t),y}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===r){var o=t.completion;if(o.type==="throw"){var n=o.arg;q(t)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,t){return this.delegate={iterator:B(r),resultName:e,nextLoc:t},this.method==="next"&&(this.arg=u),y}},i}(typeof Y=="object"?Y.exports:{});try{regeneratorRuntime=V}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=V:Function("r","regeneratorRuntime = r")(V)}});var ie=I((Ge,oe)=>{"use strict";oe.exports=ne()});var ue=I((Ae,se)=>{"use strict";function ae(i,a,s,d,u,h,l){try{var R=i[h](l),w=R.value}catch(m){s(m);return}R.done?a(w):Promise.resolve(w).then(d,u)}function _e(i){return function(){var a=this,s=arguments;return new Promise(function(d,u){var h=i.apply(a,s);function l(w){ae(h,d,u,l,R,"next",w)}function R(w){ae(h,d,u,l,R,"throw",w)}l(void 0)})}}se.exports=_e});var le=I(H=>{"use strict";var de=te();Object.defineProperty(H,"__esModule",{value:!0}),H.default=Ne;var ce=de(ie()),Te=de(ue());function Ne(i){return he.apply(this,arguments)}function he(){return(he=(0,Te.default)(ce.default.mark(function i(a){var s,d;return ce.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s=document.createElement("video"),d=new Promise(function(h,l){s.addEventListener("loadedmetadata",function(){s.duration===1/0?(s.currentTime=Number.MAX_SAFE_INTEGER,s.ontimeupdate=function(){s.ontimeupdate=null,h(s.duration),s.currentTime=0}):h(s.duration)}),s.onerror=function(R){return l(R.target.error)}}),s.src=typeof a=="string"||a instanceof String?a:window.URL.createObjectURL(a),u.abrupt("return",d);case 4:case"end":return u.stop()}},i)}))).apply(this,arguments)}});var ye=Oe(le());var E=()=>({value:!0}),T=()=>({value:!1}),fe=()=>new Error("MISSING_PERMISSION"),pe=()=>new Error("ALREADY_RECORDING");var ve=()=>new Error("DEVICE_CANNOT_VOICE_RECORD"),Q=()=>new Error("FAILED_TO_RECORD"),me=()=>new Error("EMPTY_RECORDING"),C=()=>new Error("RECORDING_HAS_NOT_STARTED"),z=()=>new Error("FAILED_TO_FETCH_RECORDING"),ge=()=>new Error("COULD_NOT_QUERY_PERMISSION_STATUS");var Ie=["audio/aac","audio/webm;codecs=opus","audio/mp4","audio/webm","audio/ogg;codecs=opus"],Re=()=>new Promise(()=>{}),b=class i{constructor(){this.mediaRecorder=null,this.chunks=[],this.pendingResult=Re()}static canDeviceVoiceRecord(){return O(this,null,function*(){var a;return((a=navigator?.mediaDevices)===null||a===void 0?void 0:a.getUserMedia)==null||i.getSupportedMimeType()==null?T():E()})}startRecording(){return O(this,null,function*(){if(this.mediaRecorder!=null)throw pe();if(!(yield i.canDeviceVoiceRecord()).value)throw ve();if(!(yield i.hasAudioRecordingPermission().catch(()=>E())).value)throw fe();return navigator.mediaDevices.getUserMedia({audio:!0}).then(this.onSuccessfullyStartedRecording.bind(this)).catch(this.onFailedToStartRecording.bind(this))})}stopRecording(){return O(this,null,function*(){if(this.mediaRecorder==null)throw C();try{return this.mediaRecorder.stop(),this.mediaRecorder.stream.getTracks().forEach(a=>a.stop()),this.pendingResult}catch{throw z()}finally{this.prepareInstanceForNextOperation()}})}static hasAudioRecordingPermission(){return O(this,null,function*(){return navigator.permissions.query({name:"microphone"}).then(a=>({value:a.state==="granted"})).catch(()=>{throw ge()})})}static requestAudioRecordingPermission(){return O(this,null,function*(){return(yield i.hasAudioRecordingPermission().catch(()=>T())).value?E():navigator.mediaDevices.getUserMedia({audio:!0}).then(()=>E()).catch(()=>T())})}pauseRecording(){if(this.mediaRecorder==null)throw C();return this.mediaRecorder.state==="recording"?(this.mediaRecorder.pause(),Promise.resolve(E())):Promise.resolve(T())}resumeRecording(){if(this.mediaRecorder==null)throw C();return this.mediaRecorder.state==="paused"?(this.mediaRecorder.resume(),Promise.resolve(E())):Promise.resolve(T())}getCurrentStatus(){return this.mediaRecorder==null?Promise.resolve({status:"NONE"}):this.mediaRecorder.state==="recording"?Promise.resolve({status:"RECORDING"}):this.mediaRecorder.state==="paused"?Promise.resolve({status:"PAUSED"}):Promise.resolve({status:"NONE"})}static getSupportedMimeType(){if(MediaRecorder?.isTypeSupported==null)return null;let a=Ie.find(s=>MediaRecorder.isTypeSupported(s));return a??null}onSuccessfullyStartedRecording(a){return this.pendingResult=new Promise((s,d)=>{this.mediaRecorder=new MediaRecorder(a),this.mediaRecorder.onerror=()=>{this.prepareInstanceForNextOperation(),d(Q())},this.mediaRecorder.onstop=()=>O(this,null,function*(){let u=i.getSupportedMimeType();if(u==null){this.prepareInstanceForNextOperation(),d(z());return}let h=new Blob(this.chunks,{type:u});if(h.size<=0){this.prepareInstanceForNextOperation(),d(me());return}let l=yield i.blobToBase64(h),R=yield(0,ye.default)(h);this.prepareInstanceForNextOperation(),s({value:{recordDataBase64:l,mimeType:u,msDuration:R*1e3}})}),this.mediaRecorder.ondataavailable=u=>this.chunks.push(u.data),this.mediaRecorder.start()}),E()}onFailedToStartRecording(){throw this.prepareInstanceForNextOperation(),Q()}static blobToBase64(a){return new Promise(s=>{let d=new FileReader;d.onloadend=()=>{let u=String(d.result),h=u.split("base64,"),l=h.length>1?h[1]:u;s(l.trim())},d.readAsDataURL(a)})}prepareInstanceForNextOperation(){if(this.mediaRecorder!=null&&this.mediaRecorder.state==="recording")try{this.mediaRecorder.stop()}catch{}this.pendingResult=Re(),this.mediaRecorder=null,this.chunks=[]}};var we=class extends ee{constructor(){super(...arguments),this.voiceRecorderInstance=new b}canDeviceVoiceRecord(){return b.canDeviceVoiceRecord()}hasAudioRecordingPermission(){return b.hasAudioRecordingPermission()}requestAudioRecordingPermission(){return b.requestAudioRecordingPermission()}startRecording(){return this.voiceRecorderInstance.startRecording()}stopRecording(){return this.voiceRecorderInstance.stopRecording()}pauseRecording(){return this.voiceRecorderInstance.pauseRecording()}resumeRecording(){return this.voiceRecorderInstance.resumeRecording()}getCurrentStatus(){return this.voiceRecorderInstance.getCurrentStatus()}};export{we as VoiceRecorderWeb};
