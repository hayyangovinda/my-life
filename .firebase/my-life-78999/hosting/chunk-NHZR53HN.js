import{a as Y,b as X,c as ee,d as te,e as ie,f as ne,g as oe,h as ae,i as se}from"./chunk-YSP3EGIP.js";import{d as J}from"./chunk-76INWWHM.js";import"./chunk-NJAWYSDF.js";import"./chunk-FDE6MBQY.js";import{b as j,g as N,l as W,o as $}from"./chunk-KKUW3EYT.js";import"./chunk-5IC5DNT2.js";import"./chunk-GIDJWLZK.js";import{a as K}from"./chunk-D6VDJXMI.js";import{a as Q}from"./chunk-XVXDBZAN.js";import"./chunk-GTL4EDMA.js";import{l as G,m as z}from"./chunk-E6I4JPOI.js";import{$ as C,Ab as l,Bb as _,Eb as x,Jb as p,Lb as g,Pb as O,Qb as V,Ra as k,Rb as R,Sb as E,Ta as D,Tb as w,Ub as F,V as L,Va as c,Vb as T,Wb as B,Xb as Z,Yb as H,_b as U,ea as P,mb as v,nc as A,oa as d,ob as f,pa as h,qa as y,qb as q,ra as M,ub as b,zb as a}from"./chunk-FVMQVLXL.js";import"./chunk-CWTPBX7D.js";var re=(()=>{let r=class r{constructor(){}formatDateToStartOfDayUTC(t){let e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}-${i}-${o}T00:00:00.000Z`}};r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=L({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();var de=["fileInput"];function he(n,r){if(n&1&&(a(0,"div",24),y(),a(1,"svg",25),_(2,"path",26),l(),M(),a(3,"p",27),w(4),l()()),n&2){let s=g().$implicit;c(4),T(" ",s.text," ")}}function pe(n,r){if(n&1){let s=x();a(0,"p",28),p("blur",function(){d(s);let e=g().index,i=g();return h(i.updateMessage(e))}),w(1),l()}if(n&2){let s=g(),t=s.$implicit,e=s.index;f("id","sent"+e),c(),T(" ",t.text," ")}}function ge(n,r){if(n&1&&_(0,"img",29),n&2){let s=g().$implicit;f("src",s.image,k)}}function me(n,r){if(n&1){let s=x();a(0,"img",30),p("click",function(){d(s);let e=g().index,i=g();return h(i.onDeleteIconClick(e))}),l()}}function ue(n,r){if(n&1){let s=x();a(0,"div",18),v(1,he,5,1,"div",19),a(2,"div",20),p("longPress",function(){let e=d(s).index,i=g();return i.showDeleteIcon=!0,h(i.deleteIconPosition=e)}),v(3,pe,2,2,"p",21)(4,ge,1,1,"img",22)(5,me,1,0,"img",23),l()()}if(n&2){let s=r.$implicit,t=r.index,e=g();q("received",s.type==="received")("sent",s.type==="sent"),c(),f("ngIf",s.type==="received"),c(2),f("ngIf",s.type==="sent"),c(),f("ngIf",s.type==="sent"&&s.image),c(),f("ngIf",e.showDeleteIcon&&s.type==="sent"&&t===e.deleteIconPosition)}}function fe(n,r){if(n&1){let s=x();a(0,"record-loader",31),p("stopRecording",function(){d(s);let e=g(2);return h(e.toggleRecording())}),l()}}function _e(n,r){n&1&&_(0,"app-loader")}function we(n,r){if(n&1&&(a(0,"div",17),v(1,fe,1,0,"record-loader")(2,_e,1,0,"app-loader"),l()),n&2){let s=g();c(),b(1,s.showRecordingLoader?1:-1),c(),b(2,s.showImageLoader?2:-1)}}var He=(()=>{let r=class r{constructor(){this.inputs=[],this.todayDate=new Date("2024-08-03"),this.newMessage="",this.httpService=C(Q),this.utilsService=C(re),this.sharingService=C(K),this.changeDetectorRef=C(A),this.showDeleteIcon=!1,this.deleteIconPosition=null,this.canRecord=!1,this.isRecording=!1,this.recorder=null,this.chunks=[],this.selectedFile=null,this.messages=[{text:"Hello! What's new today?",type:"received",image:null}],this.response="",this.audioSrc="",this.showRecordingLoader=!1,this.showImageLoader=!1,this.showLoaders=!1}ngOnInit(){this.showLoaders=!0,this.showImageLoader=!0;let t=this.utilsService.formatDateToStartOfDayUTC(this.todayDate),e=t;this.dateParam&&(e=this.dateParam),console.log(this.dateParam),this.setUpAudio(),this.httpService.getDayChat(e).subscribe(i=>{this.showLoaders=!1,this.showImageLoader=!1,i.length?(this.todayChat=i[0],this.messages=this.todayChat.inputs,this.scrollChatToBottom()):this.httpService.createDayChat({date:t,inputs:[{text:"Hello! What's new today?",type:"received",image:null}]}).subscribe(o=>{this.showLoaders=!1,this.showImageLoader=!1,this.todayChat=o},o=>{this.showLoaders=!1,this.showImageLoader=!1,console.log(o)})},i=>{this.showLoaders=!1,this.showImageLoader=!1,console.log(i)})}autoGrow(t){let e=t.target;e.style.height="auto",e.value?e.style.height=e.scrollHeight+"px":e.style.height="40px"}sendMessage(){if(this.newMessage.trim()!==""){this.messages.push({text:this.newMessage,type:"sent",image:null});let t=["Got it!","Understood!","Noted!","Message received!","Roger that!","Gotcha!"],e=Math.floor(Math.random()*t.length),i=t[e];this.messages.push({text:i,type:"received",image:null}),this.todayChat.inputs=this.messages,this.httpService.updateDayChat(this.todayChat._id,{inputs:this.todayChat.inputs}).subscribe(o=>{}),this.newMessage="",this.scrollChatToBottom()}}onEnter(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}scrollChatToBottom(){setTimeout(()=>{let t=document.getElementById("chatBody");t&&(t.scrollTop=t.scrollHeight)},0)}toggleSidenav(){this.sharingService.toggleSidenav()}handleClick(t){let e=t.target;!e.classList.contains("delete-icon")&&!e.classList.contains("sent")&&(this.showDeleteIcon=!1,this.deleteIconPosition=null)}onDeleteIconClick(t){this.showDeleteIcon=!1,this.deleteIconPosition=null,this.messages.splice(t,2),this.todayChat.inputs=this.messages,this.httpService.updateDayChat(this.todayChat._id,{inputs:this.todayChat.inputs}).subscribe(e=>{})}setUpAudio(){console.log("navigator",navigator.mediaDevices),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!0}).then(t=>{this.recorder=new MediaRecorder(t),this.recorder.ondataavailable=e=>{this.chunks.push(e.data)},this.recorder.onstop=()=>{let e=new Blob(this.chunks,{type:"audio/aiff"});this.chunks=[];let i=URL.createObjectURL(e);this.audioSrc=i,this.selectedFile=new File([e],"recording.wav",{type:"audio/wav"}),console.log("recording-stop"),console.log(this.selectedFile);let o=new FormData;o.append("audio",this.selectedFile),this.transcribeAudioBlob(o)}}),this.canRecord=!0}toggleRecording(){this.canRecord&&(this.isRecording?(this.recorder?.stop(),this.showLoaders=!1,this.showRecordingLoader=!1,this.isRecording=!1):(this.showLoaders=!0,this.showRecordingLoader=!0,this.recorder?.start(),this.isRecording=!0))}transcribeAudio(t){this.httpService.transcribeAudio({audio:t}).subscribe(e=>{console.log(e),this.newMessage=JSON.stringify(e)})}transcribeAudioBlob(t){this.showLoaders=!0,this.showImageLoader=!0,this.changeDetectorRef.detectChanges(),this.httpService.transcribeAudio(t).subscribe(e=>{console.log(e),this.newMessage=e.transcripts[0]+"a",this.showLoaders=!1,this.showImageLoader=!1,this.changeDetectorRef.detectChanges()},()=>{this.showLoaders=!1,this.showImageLoader=!1,this.changeDetectorRef.detectChanges()})}openFileUploader(t){t==="camera"&&(this.fileInput.nativeElement.capture="environment"),t==="gallery"&&this.fileInput.nativeElement.removeAttribute("capture"),this.fileInput.nativeElement.click()}onFileSelected(t){this.showLoaders=!0,this.showImageLoader=!0;let e=t.target;if(e.files&&e.files.length>0){let i=e.files[0],o=new FileReader;o.onload=m=>{let u=new FormData;u.append("image",i),this.httpService.uploadImage(u).subscribe(S=>{let le=S.image.src;this.messages.push({text:"~",type:"sent",image:le}),this.todayChat.inputs=this.messages,this.httpService.updateDayChat(this.todayChat._id,{inputs:this.todayChat.inputs}).subscribe(I=>{this.showLoaders=!1,this.showImageLoader=!1,this.scrollChatToBottom()},I=>{this.showLoaders=!1,this.showImageLoader=!1,console.log(I)})},S=>{this.showLoaders=!1,this.showImageLoader=!1,console.log(S)})},o.readAsDataURL(i)}}updateMessage(t){let e=this.messages[t],i=document.getElementById("sent"+t)?.innerText;i!==void 0&&(this.messages[t].text=i,this.httpService.updateDayChat(this.todayChat._id,{inputs:this.todayChat.inputs}).subscribe(o=>{}))}};r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=P({type:r,selectors:[["app-chat"]],viewQuery:function(e,i){if(e&1&&O(de,5),e&2){let o;V(o=R())&&(i.fileInput=o.first)}},hostBindings:function(e,i){e&1&&p("click",function(m){return i.handleClick(m)},!1,D)},inputs:{dateParam:"dateParam"},standalone:!0,features:[U],decls:33,vars:5,consts:[["menu","matMenu"],["fileInput",""],[1,"header-container"],["xmlns","http://www.w3.org/2000/svg","height","30px","viewBox","0 -960 960 960","width","30px","fill","var(--black-text-color)",3,"click"],["d","M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"],["id","chatBody",1,"chat-body"],["class","message",3,"received","sent",4,"ngFor","ngForOf"],["xmlns","http://www.w3.org/2000/svg","height","30px","viewBox","0 -960 960 960","width","30px","fill","var(--black-text-color)",1,"camera",3,"matMenuTriggerFor"],["d","M480-260q75 0 127.5-52.5T660-440q0-75-52.5-127.5T480-620q-75 0-127.5 52.5T300-440q0 75 52.5 127.5T480-260Zm0-80q-42 0-71-29t-29-71q0-42 29-71t71-29q42 0 71 29t29 71q0 42-29 71t-71 29ZM160-120q-33 0-56.5-23.5T80-200v-480q0-33 23.5-56.5T160-760h126l74-80h240l74 80h126q33 0 56.5 23.5T880-680v480q0 33-23.5 56.5T800-120H160Zm0-80h640v-480H638l-73-80H395l-73 80H160v480Zm320-240Z"],["mat-menu-item","",3,"click"],["type","file","accept","image/*",2,"display","none",3,"change"],[1,"text-area-wrapper"],["placeholder","Type a message",3,"ngModelChange","input","ngModel"],["xmlns","http://www.w3.org/2000/svg","height","24px","viewBox","0 -960 960 960","width","24px","fill","#ff5b24",3,"click"],["d","M480-400q-50 0-85-35t-35-85v-240q0-50 35-85t85-35q50 0 85 35t35 85v240q0 50-35 85t-85 35Zm0-240Zm-40 520v-123q-104-14-172-93t-68-184h80q0 83 58.5 141.5T480-320q83 0 141.5-58.5T680-520h80q0 105-68 184t-172 93v123h-80Zm40-360q17 0 28.5-11.5T520-520v-240q0-17-11.5-28.5T480-800q-17 0-28.5 11.5T440-760v240q0 17 11.5 28.5T480-480Z"],["xmlns","http://www.w3.org/2000/svg","height","30px","viewBox","0 -960 960 960","width","30px","fill","var(--black-text-color)",1,"send",3,"click"],["d","m357-384 123-123 123 123 57-56-180-180-180 180 57 56ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"],[1,"loader"],[1,"message"],["class","received-container",4,"ngIf"],["appLongPress","",1,"message-container",3,"longPress"],["contenteditable","true","class","sent",3,"id","blur",4,"ngIf"],["alt","Sent Image","class","chat-image",3,"src",4,"ngIf"],["class","delete-icon","src","../../assets/icons/delete.png",3,"click",4,"ngIf"],[1,"received-container"],["xmlns","http://www.w3.org/2000/svg","height","24px","viewBox","0 -960 960 960","width","24px","fill","var(--black-text-color)"],["d","m480-193 85-85 57 56L480-80 338-222l57-56 85 85ZM193-480l85 85-56 57L80-480l142-142 56 57-85 85Zm574 0-85-85 56-57 142 142-142 142-56-57 85-85ZM480-767l-85 85-57-56 142-142 142 142-57 56-85-85Z"],[1,"received"],["contenteditable","true",1,"sent",3,"blur","id"],["alt","Sent Image",1,"chat-image",3,"src"],["src","../../assets/icons/delete.png",1,"delete-icon",3,"click"],[3,"stopRecording"]],template:function(e,i){if(e&1){let o=x();a(0,"main")(1,"header")(2,"div",2),y(),a(3,"svg",3),p("click",function(){return d(o),h(i.toggleSidenav())}),_(4,"path",4),l(),M(),a(5,"h5"),w(6),l()()(),a(7,"div",5),v(8,ue,6,8,"div",6),l(),a(9,"footer"),y(),a(10,"svg",7),_(11,"path",8),l(),M(),a(12,"mat-menu",null,0)(14,"button",9),p("click",function(){return d(o),h(i.openFileUploader("camera"))}),a(15,"mat-icon"),w(16,"camera"),l(),a(17,"span"),w(18,"Camera"),l()(),a(19,"button",9),p("click",function(){return d(o),h(i.openFileUploader("gallery"))}),a(20,"mat-icon"),w(21,"photos"),l(),a(22,"span"),w(23,"Gallery"),l()()(),a(24,"input",10,1),p("change",function(u){return d(o),h(i.onFileSelected(u))}),l(),a(26,"div",11)(27,"textarea",12),H("ngModelChange",function(u){return d(o),Z(i.newMessage,u)||(i.newMessage=u),h(u)}),p("input",function(u){return d(o),h(i.autoGrow(u))}),l(),y(),a(28,"svg",13),p("click",function(){return d(o),h(i.toggleRecording())}),_(29,"path",14),l()(),a(30,"svg",15),p("click",function(){return d(o),h(i.sendMessage())}),_(31,"path",16),l()()(),v(32,we,3,2,"div",17)}if(e&2){let o=E(13);c(6),F(i.chatToView?i.chatToView.dateFormatted:"Today"),c(2),f("ngForOf",i.messages),c(2),f("matMenuTriggerFor",o),c(17),B("ngModel",i.newMessage),c(5),b(32,i.showLoaders?32:-1)}},dependencies:[G,$,j,N,W,z,J,Y,ie,ee,X,te,oe,ne,ae,se],styles:["main[_ngcontent-%COMP%]{height:100%;overflow-y:hidden;background-color:var(--secondary-bg-color)}footer[_ngcontent-%COMP%]{position:absolute;bottom:5px;width:100%;display:flex;align-items:center}footer[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{flex:1;padding:10px;border:1px solid #ddd;border-radius:10px;resize:none;height:40px;max-height:120px;overflow-y:auto;outline:none}.camera[_ngcontent-%COMP%]{width:30px;height:30px;margin-left:10px;border-radius:50%}.send[_ngcontent-%COMP%]{width:30px;height:30px;margin-right:10px;border-radius:50%}.chat-body[_ngcontent-%COMP%]{height:calc(100% - 100px);overflow-y:scroll;padding:10px;display:flex;flex-direction:column;gap:10px;font-size:.9rem}.message[_ngcontent-%COMP%]{margin-bottom:10px;padding:8px;border-radius:8px;word-wrap:break-word;max-width:90%}.message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.message.received[_ngcontent-%COMP%]{color:var(--black-text-color);text-align:left;align-self:flex-start;background-color:var(--main-bg-color)}.message.sent[_ngcontent-%COMP%]{color:var(--sent-text-color);align-self:flex-end;margin-left:auto;display:inline-block;background-color:var(--primary-color);padding:5px 10px;text-align:right}textarea[_ngcontent-%COMP%]{flex:1;resize:none;padding:8px;border-radius:8px;border:1px solid #ccc;width:100%;background-color:var(--secondary-bg-color);color:var(--black-text-color)}.send[_ngcontent-%COMP%], .camera[_ngcontent-%COMP%]{cursor:pointer}.received-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.received-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px;height:30px}header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;background-image:var(--header-border-color);border:0;box-shadow:var(--header-shadow);box-sizing:border-box;padding-bottom:1px}header[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:30px;height:30px;cursor:pointer;margin-left:10px}h5[_ngcontent-%COMP%]{color:var(--title-color);font-size:15px}.header-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;background-color:var(--secondary-bg-color);padding:9px 3px;width:100%;height:100%;color:#757575}.message-container[_ngcontent-%COMP%]{position:relative}.delete-icon[_ngcontent-%COMP%]{width:19px;height:19px;cursor:pointer;position:absolute;right:-17px;top:-12px}.text-area-wrapper[_ngcontent-%COMP%]{width:100%;margin:0 10px;position:relative}.text-area-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;right:12px;bottom:12px;cursor:pointer}.chat-image[_ngcontent-%COMP%]{max-width:100%;height:200px;object-fit:cover}.loader[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#252525e6;z-index:100;display:flex;align-items:center;justify-content:center}"]});let n=r;return n})();export{He as ChatComponent};
